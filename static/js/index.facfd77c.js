(()=>{"use strict";var e={4830:function(e,t,n){var r,l,i,o,c=n(2676),a=n(8751),u=n(7070),d=n(4181),s=n(9981),h=n.n(s),f=n(6398),p=((r={}).selection="selection",r.rectangle="rectangle",r.circle="circle",r.arrow="arrow",r.text="text",r.diamond="diamond",r),y=((l={}).default="default",l.crosshair="crosshair",l.move="move",l.grab="grab",l.neswResize="nesw-resize",l.nwseResize="nwse-resize",l),g=((i={}).top="TOP",i.bottom="BOTTOM",i),m=((o={}).left="left",o.center="center",o);let v="Segoe UI Emoji",x="SPICY_CHICKEN_DRAW",w=[3,2],b=[p.circle,p.diamond,p.rectangle],R="CLEAR",E="IMPORT",M="EXPORT",Z="EXPORT_IMAGE",_={theme:"outline",size:"20",fill:"#333"},j=(0,f.cn)(p.selection),k=(0,f.cn)(y.default);var I=n(634),S=n(4872),O=n(6369),z=n(8174),P=n(1458),T=n(223);let C=[{type:p.selection,Icon:I.Z},{type:p.rectangle,Icon:S.Z},{type:p.circle,Icon:O.Z},{type:p.diamond,Icon:z.Z},{type:p.text,Icon:P.Z},{type:p.arrow,Icon:T.Z}],D=()=>{let[e,t]=(0,f.KO)(j),n=(0,f.b9)(k);return(0,u.Z)(Array(C.length).fill(null).map((e,t)=>String(t+1)),e=>{let n=C[Number(e.key)-1];n&&t(n.type)}),(0,d.Z)(()=>{e!==p.selection&&n(y.crosshair)},[e]),(0,c.jsx)("div",{className:"flex absolute top-3 left-1/2 -translate-x-1/2 rounded bg-slate-50 shadow",children:C.map((n,r)=>{let{Icon:l,type:i}=n;return(0,c.jsxs)("div",{className:h()("w-11 h-10 flex items-center justify-center flex-col cursor-pointer",e===i?"bg-slate-300":"hover:bg-slate-200"),onClick:()=>t(i),children:[(0,c.jsx)(l,{..._}),(0,c.jsx)("div",{className:"text-xs select-none",children:r+1})]},i)})})};var N=n(2422),$=n(2501);let A=(e,t)=>{let n=()=>{!(e.some(e=>!e.current)||t.some(e=>!e.current))&&e.forEach((e,n)=>{var r,l,i;if(!e.current)return;let{innerWidth:o,innerHeight:c,devicePixelRatio:a}=window;e.current.width=o,e.current.height=c,e.current.style.width=`${o}px`,e.current.style.height=`${c}px`,e.current.width=a*o,e.current.height=a*c,null===(i=t[n])||void 0===i||null===(l=i.current)||void 0===l||null===(r=l.scale)||void 0===r||r.call(l,a,a)})};(0,N.Z)(n),(0,$.Z)("resize",n,{target:window})};var U=n(5271),W=n(617);let F=()=>{let e=(0,U.useRef)(null),t=(0,U.useRef)(null),n=(0,U.useRef)(null),r=(0,U.useRef)(null),l=(0,U.useRef)(null),i=(0,U.useRef)(null);return(0,N.Z)(()=>{e.current&&t.current&&(n.current=e.current.getContext("2d"),r.current=t.current.getContext("2d"),l.current=W.Z.canvas(e.current),i.current=W.Z.canvas(t.current))}),{staticCanvasRef:e,activeCanvasRef:t,staticCanvasCtx:n,activeCanvasCtx:r,staticRoughCanvas:l,activeRoughCanvas:i}},L=(e,t)=>{let[n,r,l,i]=ed(t);J(e,n),J(e,r),t.type!==p.arrow&&(J(e,l),J(e,i))},B=(e,t,n)=>{let{x:r,y:l,width:i,height:o,type:c}=t,a=i>0?3:-3,u=o>0?3:-3,d=r-a,s=r+i+a,h=l-u,f=l+o+u;e.strokeStyle="rgb(105, 101, 219)",e.beginPath(),(null==n?void 0:n.isDashLine)&&e.setLineDash(w),e.moveTo(d,h),e.lineTo(s,h),e.lineTo(s,f),e.lineTo(d,f),e.closePath(),e.stroke(),e.setLineDash([]),e.beginPath(),(null==n?void 0:n.withoutResizeRect)||L(e,{x:r,y:l,width:i,height:o,type:c}),e.stroke(),e.strokeStyle="#000"},J=(e,t)=>{let{x:n,y:r,width:l,height:i}=t;e.moveTo(n,r),e.lineTo(n+l,r),e.lineTo(n+l,r+i),e.lineTo(n,r+i),e.closePath()},H=(e,t)=>{let{x:n,y:r,width:l,height:i,seed:o}=t;e.rectangle(n,r,l,i,{seed:o})},K=(e,t)=>{let{x:n,y:r,width:l,height:i,seed:o}=t;e.ellipse(n+l/2,r+i/2,l,i,{seed:o})},q=(e,t)=>{let{x:n,y:r,width:l,height:i,seed:o}=t;e.polygon([[n+l/2,r],[n+l,r+i/2],[n+l/2,r+i],[n,r+i/2]],{seed:o})},X=(e,t)=>{let{x:n,y:r,width:l,height:i}=t;e.save(),e.fillStyle="rgb(224, 223, 255)",e.fillRect(n,r,l,i),e.restore()},G=(e,t)=>{let{x:n,y:r,width:l,height:i,seed:o}=t,c=Math.min((l*l+i*i)**.5/2,30),a=i<0?-c:c,u=Math.floor(180/(Math.PI/Math.atan(l/i))),d=u+30,s=u-30,h=n+l,f=r+i,p=h-a*Math.sin(Math.PI*d/180),y=f-a*Math.cos(Math.PI*d/180),g=h-a*Math.sin(Math.PI*s/180),m=f-a*Math.cos(Math.PI*s/180),v={seed:o};e.line(n,r,h,f,v),e.line(h,f,p,y,v),e.line(h,f,g,m,v)},Y=(e,t)=>{let{x:n,y:r,content:l,width:i,fontSize:o,textAlign:c}=t;(null==l?void 0:l.trim())&&(e.textBaseline="bottom",e.font=`${o}px  ${v}`,en(l).forEach((t,l)=>{let a=0;if(c===m.left&&(a=n),c===m.center){let{width:r}=e.measureText(t);a=n+(i-r)/2}e.fillText(t,a,r+o*(l+1))}))},Q=(e,t,n)=>{switch(n.type){case p.selection:X(e,n);return;case p.rectangle:H(t,n);return;case p.circle:K(t,n);return;case p.diamond:q(t,n);return;case p.arrow:G(t,n);return;case p.text:Y(e,n);return}},V=(e,t)=>{let n=t.filter(e=>e.selected),r=n.length>1;if(r){let[t,r,l,i]=eu(n);B(e,{x:t,y:l,width:r-t,height:i-l,type:p.selection},{isDashLine:!0})}n.forEach(t=>{B(e,t,{withoutResizeRect:r})})},ee=(e,t,n)=>{e.clearRect(0,0,e.canvas.width,e.canvas.height),V(e,n),e.beginPath(),n.forEach(n=>{Q(e,t,n)}),e.stroke()},et=e=>e.replace(/\r\n?/g,"\n").split("\n"),en=e=>{let t=et(e);return t.filter((e,n)=>!!e.trim()||n!==t.length-1)},er=(e,t)=>Math.max(e,e+t),el=(e,t)=>Math.min(e,e+t),ei=e=>[el(e.x,e.width),er(e.x,e.width),el(e.y,e.height),er(e.y,e.height)],eo=e=>e>5?e-5:0,ec=e=>e+5,ea=(e,t,n)=>e>=eo(t)&&e<=ec(n??t),eu=e=>{let t=-1/0,n=-1/0,r=1/0,l=1/0;return e.forEach(e=>{let[i,o,c,a]=ei(e);o>t&&(t=o),i<r&&(r=i),a>n&&(n=a),c<l&&(l=c)}),[r,t,l,n]},ed=e=>{let{x:t,y:n,width:r,height:l}=e,i=r>0?3:-3,o=l>0?3:-3,c=t-i,a=t+r+i,u=n-o,d=n+l+o,s=r>0?8:-8,h=l>0?8:-8,f=(e,t,n,r)=>({x:e,y:t,width:n,height:r});return[f(c,u,-s,-h),f(a,d,s,h),f(a,u,s,-h),f(c,d,-s,h)]},es=e=>e.width>0&&e.height>0||e.type===p.arrow?e:{...e,x:e.width>0?e.x:e.x+e.width,y:e.height>0?e.y:e.y+e.height,width:e.width>0?e.width:-e.width,height:e.height>0?e.height:-e.height},eh=e=>{let t=[];return e.forEach(n=>{if(n.selected&&(t.push(n),"boundingElements"in n)){var r;null===(r=n.boundingElements)||void 0===r||r.forEach(n=>{let r=e.find(e=>n.id===e.id);r&&t.push(r)})}}),t},ef=()=>document.querySelector("textarea")?null:document.createElement("textarea"),ep=(e,t,n,r,l)=>{let{onInput:i,onChange:o}=r;e.onkeydown=e=>{e.stopPropagation()},e.oninput=t=>{e.style.height=`${e.scrollHeight}px`,null==i||i(t.target.value)},e.onblur=r=>{o(r.target.value,t,n,l),document.body.removeChild(e)},setTimeout(()=>{e.focus()})},ey=(e,t)=>Object.assign(e.style,{position:"absolute",margin:0,padding:0,border:0,outline:0,background:"transparent",resize:"none",lineHeight:"1em",fontFamily:v,overflow:"hidden",...t}),eg=(e,t,n)=>{let{x:r,y:l}=e,i=(null==n?void 0:n.fontSize)||15;if(!t)return{top:`${(null==n?void 0:n.y)??l}px`,left:`${(null==n?void 0:n.x)??r}px`,width:`${window.innerWidth-r}px`,whiteSpace:"nowrap",fontSize:`${i}px`};let o=(n?en(n.content).length:1)*i;return{top:`${t.y+t.height/2-o/2}px`,left:`${t.x-(t.width<0?t.width:0)}px`,width:`${t.width}px`,height:`${o}px`,textAlign:"center",fontSize:`${i}px`}},em=(e,t,n,r,l)=>{let i=ef();i&&((null==l?void 0:l.content)&&(i.value=l.content,i.setSelectionRange(0,l.content.length)),ey(i,eg(e,n,l)),ep(i,e,n,{onChange:t,onInput:r},l),document.body.appendChild(i))},ev=(e,t,n,r)=>(Math.abs(e-t)**2+Math.abs(n-r)**2)**.5,ex=(e,t)=>{let{x:n,y:r}=e,l=t.filter(e=>e.selected);if(l.length){if(l.length>1){let[e,t,i,o]=eu(l);if(ea(n,e,t)&&ea(r,i,o))return l}else{let[e,t,i,o]=ei(l[0]);if(ea(n,e,t)&&ea(r,i,o))return l[0]}}for(let e of t){let[t,l,i,o]=ei(e);if(e.type===p.text&&ea(n,t,l)&&ea(r,i,o)||e.type===p.rectangle&&((ea(n,t)||ea(n,l))&&ea(r,i,o)||(ea(r,i)||ea(r,o))&&ea(n,t,l)))return e;if(e.type===p.circle){let t=e.width/2,l=e.height/2,i=(n-(e.x+t))**2/t**2+(r-(e.y+l))**2/l**2;if(i<=1.2&&i>=.9)return e}if(e.type===p.diamond){let t=e.width*e.height,l=Math.abs(n-(e.x+e.width/2)),i=Math.abs(r-(e.y+e.height/2)),o=(ec(l)*e.height+ec(i)*e.width)*2,c=(eo(l)*e.height+eo(i)*e.width)*2;if(o>=t&&c<=t)return e}if(e.type===p.arrow){let c=Math.round(ev(t,l,i,o)),a=Math.round(ev(n,e.x,r,e.y)+ev(n,e.x+e.width,r,e.y+e.height));if(a>=c-2.5&&a<=c+2.5)return e}}return null},ew=(e,t)=>{let{x:n,y:r}=e,l=null;return t.forEach(e=>{if(!b.includes(e.type))return;let[t,i]=[e.x+e.width/2,e.y+e.height/2];n<=t+10&&n>=t-10&&r<=i+10&&r>=i-10&&(l?e.width<l.width&&(l=e):l=e)}),l},eb=(e,t)=>{let{x:n,y:r}=e;return t.find(e=>e.type===p.text&&n>=e.x&&r>=e.y&&n<=e.x+e.width&&r<=e.y+e.height)},eR=(e,t)=>{let n=t.filter(e=>e.selected);if(!n.length)return null;let r=(t,n)=>{let{length:r}=t;for(let l=0;l<r;l++){let{x:r,width:i,y:o,height:c}=t[l];if(ea(e.x,el(r,i),er(r,i))&&ea(e.y,el(o,c),er(o,c)))return{cursorConfig:i*c>0?y.nwseResize:y.neswResize,position:[0,2].includes(l)===n.height>0?g.top:g.bottom}}return null};if(1===n.length){let e=n[0];return r(ed(e),e)}{let[e,t,l,i]=eu(n),o={x:e,y:l,width:t-e,height:i-l};return r(ed(o),o)}},eE=(0,n(7977).Z)(),eM=e=>{let t=new Blob(["\uFEFF"+e],{type:"text/json"});return URL.createObjectURL(t)},eZ=(e,t)=>{let n=document.createElement("a");n.download=t,n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)};var e_=n(8296),ej=n(6541),ek=n(720),eI=n(1729),eS=n(6103),eO=new WeakMap,ez=new WeakMap,eP=new WeakSet,eT=new WeakSet,eC=new WeakSet,eD=new WeakSet;function eN(e){(0,e_._)(this,ez).push(e),(0,ek._)(this,eO,[])}function e$(e,t){var n;let r=[...(null==t?void 0:null===(n=t.keys)||void 0===n?void 0:n.call(t))||[]];r.length&&(e.value=e.value.filter(e=>!r.includes(e.id)))}function eA(e,t,n){null==n||n.forEach(n=>{let r=n[t];r&&e.value.push({...r,selected:!("containerId"in r)||!(null==r?void 0:r.containerId)})})}function eU(e,t,n){(null==n?void 0:n.size)&&(e.value=e.value.map(e=>{let r=n.get(e.id);if(!r)return e;let l=r[t];return{...e,...l,selected:(null==l?void 0:l.selected)??(!("containerId"in e)||!e.containerId)}}))}let eW=new class{redo(e){let t=(0,e_._)(this,eO).pop();if(!t)return null;(0,e_._)(this,ez).push(t);let{added:n,removed:r,updated:l}=t,i={value:e.map(e=>({...e,selected:!1}))};return(0,eI._)(this,eC,eA).call(this,i,"payload",n),(0,eI._)(this,eT,e$).call(this,i,r),(0,eI._)(this,eD,eU).call(this,i,"payload",l),i.value}undo(e){let t=(0,e_._)(this,ez).pop();if(!t)return null;(0,e_._)(this,eO).push(t);let{added:n,removed:r,updated:l}=t,i={value:e.map(e=>({...e,selected:!1}))};return(0,eI._)(this,eC,eA).call(this,i,"deleted",r),(0,eI._)(this,eT,e$).call(this,i,n),(0,eI._)(this,eD,eU).call(this,i,"deleted",l),i.value}collectRemovedRecord(e){let t=new Map;e.forEach(e=>{t.set(e.id,{deleted:e})}),(0,eI._)(this,eP,eN).call(this,{removed:t})}transformUpdatedRecordData(e){let t=new Map;return e.forEach(e=>{let n=t.get(e.id);n?t.set(e.id,{payload:{...n.payload,...e.value.payload},deleted:{...n.deleted,...e.value.deleted}}):t.set(e.id,e.value)}),t}collectAddedRecord(e,t){let n=new Map;e.forEach(e=>{n.set(e.id,{payload:e})}),(0,eI._)(this,eP,eN).call(this,{added:n,updated:t?this.transformUpdatedRecordData(t):void 0})}collectUpdatedRecord(e){(0,eI._)(this,eP,eN).call(this,{updated:this.transformUpdatedRecordData(e)})}constructor(){(0,eS._)(this,eP),(0,eS._)(this,eT),(0,eS._)(this,eC),(0,eS._)(this,eD),(0,ej._)(this,eO,{writable:!0,value:[]}),(0,ej._)(this,ez,{writable:!0,value:[]})}},eF=e=>{let{staticDrawData:t,activeDrawData:n,staticCanvasCtx:r,activeCanvasCtx:l,staticRoughCanvas:i,activeRoughCanvas:o}=e,c=e=>{r.current&&i.current&&(ee(r.current,i.current,t),e||localStorage.setItem(x,JSON.stringify(t)))},a=()=>{l.current&&o.current&&ee(l.current,o.current,n)};(0,d.Z)(()=>{a()},[n]),(0,U.useEffect)(()=>{c()},[t]),(0,$.Z)("resize",()=>{c(!0),a()},{target:window})};var eL=n(7866);let eB=e=>{let{moveCoordinate:t,staticDrawData:n,setResizePosition:r}=e,l=(0,f.Dv)(j),i=(0,f.b9)(k);return{handleCursorPoint:()=>{if(l===p.selection){let e=eR(t,n);if(e){i(e.cursorConfig),r(e.position);return}if(ex(t,n)){i(y.move);return}i(y.default)}else i(y.crosshair)}}};var eJ=n(6348);let eH=e=>{let{startCoordinate:t,moveCoordinate:n,staticDrawData:r,setStaticDrawData:l,setActiveDrawData:i}=e,o=(0,U.useRef)(null),[c,a]=(0,f.KO)(j);return{handleDrawElement:()=>{if(!t){if(o.current){if(![p.selection,p.text].includes(o.current.type)&&(Math.abs(o.current.width)>=3||Math.abs(o.current.height)>=3)){let e=es({...o.current,selected:!0});eW.collectAddedRecord([e]),l(t=>[...t,e])}if(o.current.type===p.selection){let e=r.filter(e=>e.selected);if(e.length){let t=[];e.forEach(e=>{t.push({id:e.id,value:{payload:{selected:!0},deleted:{selected:!1}}})}),eW.collectUpdatedRecord(t)}}i([]),o.current=null,a(p.selection)}return!1}if(!o.current)return o.current={id:(0,eJ.x0)(),type:c,width:0,height:0,selected:!1,seed:Math.ceil(1e5*Math.random()),...t},!0;if(o.current.width=n.x-t.x,o.current.height=n.y-t.y,i([o.current]),c===p.selection){let e=o.current;l(t=>t.map(t=>{if("containerId"in t&&t.containerId)return t;let n=el(t.x,t.width)>=el(e.x,e.width)&&er(t.x,t.width)<=er(e.x,e.width)&&el(t.y,t.height)>=el(e.y,e.height)&&er(t.y,t.height)<=er(e.y,e.height);return{...t,selected:n}}))}return!0}}};var eK=n(9253);let eq=e=>{let{startCoordinate:t,moveCoordinate:n,setStaticDrawData:r,setActiveDrawData:l,staticDrawData:i,activeDrawData:o,resetSelectedHistoryRecordTimer:c,resizePosition:a}=e,u=(0,f.Dv)(k),d=(0,U.useRef)([]),s=(0,U.useRef)(null),h=e=>!e.current.length&&(e.current=eh(i),!!e.current.length)&&(l(e.current),r(t=>t.filter(t=>!e.current.some(e=>e.id===t.id))),!0),m=(e,t)=>{e.current.forEach(e=>{let n=o.find(t=>e.id===t.id);n&&v.current.push({id:e.id,value:{payload:t(n),deleted:t(e)}})})},v=(0,U.useRef)([]),x=()=>{v.current.length&&(eW.collectUpdatedRecord(v.current),v.current=[])},w=(0,U.useRef)([]);return{handleResizeElement:()=>{if(!t){let e=!1;return d.current.length&&(m(d,e=>({x:e.x,y:e.y,width:e.width,height:e.height})),r(e=>[...e,...o.map(es)]),l([]),d.current=[],s.current=null,e=!0),x(),e}if(![y.neswResize,y.nwseResize].includes(u))return!1;if(h(d))return!0;if(d.current.length){let e=n.x-t.x,r=n.y-t.y;s.current||(s.current=eu(o));let[i,c,h,f]=s.current,[m,v]=[c-i,f-h],x=d.current.some(e=>e.type===p.text);l(t=>(0,eK.Uy)(t,t=>{d.current.forEach(n=>{let l=t.find(e=>e.id===n.id);if(!l)return;let o=(e,t)=>{let r=0,o=0,d=0,s=0,x=n.width/m*e,w=n.height/v*t;u===y.neswResize?a.current===g.top?(r=n.x-i,o=f-n.y,d=x,s=-w):(r=c-n.x,o=n.y-h,d=-x,s=w):u===y.nwseResize&&(a.current===g.top?(r=c-n.x,o=f-n.y,d=-x,s=-w):(r=n.x-i,o=n.y-h,d=x,s=w)),l.x=n.x+r/m*e,l.y=n.y+o/v*t,l.width=n.width+d;let b=n.height+s;if(l.height=b,l.type===p.text){let e=en(l.content);l.fontSize=b/e.length}};if(x){let t=m/v,n=n=>{o((()=>{if(!n)return e;let l=Math.abs(r*t);return e>0?l:-l})(),(()=>{if(n)return r;let l=Math.abs(e/t);return r>0?l:-l})())},l=(n,l,i)=>{o(l*Math.abs((()=>{if(n)return e;let l=Math.abs(r*t);return e>0?l:-l})()),i*Math.abs((()=>{if(!n)return r;let l=Math.abs(e/t);return r>0?l:-l})()))};u===y.neswResize?a.current===g.top?e<=0&&r>=0?n(e/t<-r):l(e/t>-r,1,-1):e>=0&&r<=0?n(e/t>-r):l(e/t<-r,-1,1):u===y.nwseResize&&(a.current===g.top?e>=0&&r>=0?n(e/t>r):l(e/t<r,-1,-1):e<=0&&r<=0?n(e/t<r):l(e/t>r,1,1))}else o(e,r)})}))}return!0},handleMoveElement:e=>{if(!t){let e=!1;return w.current.length&&(m(w,e=>({x:e.x,y:e.y})),r(e=>[...e,...o]),l([]),w.current=[],e=!0),x(),e}let a=ex(t,[...i,...o]);if(e&&i.find(e=>e.selected)){let e=[];r(t=>t.map(t=>t.selected?(e.push({id:t.id,value:{payload:{selected:!1},deleted:{selected:!0}}}),{...t,selected:!1}):t)),c.current=setTimeout(()=>{eW.collectUpdatedRecord(e)})}if(u!==y.move)return!1;if(!Array.isArray(a)&&(null==a?void 0:a.selected)===!1){let e=("containerId"in a?a.containerId:a.id)||a.id;return r(t=>t.map(t=>t.id===e?(v.current.push({id:t.id,value:{payload:{selected:!0},deleted:{selected:!1}}}),{...t,selected:!0}):t)),!0}return!!h(w)||(w.current.length&&l(e=>e.map(e=>{let r=w.current.find(t=>t.id===e.id);return r?{...r,x:r.x+n.x-t.x,y:r.y+n.y-t.y}:e})),!0)}}},eX=e=>{let{staticDrawData:t,activeDrawData:n,setStaticDrawData:r}=e,l=(0,U.useRef)(null),i=(0,f.b9)(j),o=(0,f.b9)(k),c=(e,t,n,i)=>{if(e.trim()&&(t||i)){let l=0,o=document.createElement("canvas").getContext("2d"),c=en(e),a=(null==i?void 0:i.fontSize)||15;o&&(o.font=`${a}px  ${v}`,c.forEach(e=>{let{width:t}=o.measureText(e);t>l&&(l=t)}));let u=a*c.length,d=n?{x:n.x+(n.width-l)/2,y:n.y+n.height/2-u/2}:i?{x:i.x,y:i.y}:t,s=i?i.id:(0,eJ.x0)(),h={id:s,type:p.text,content:e,width:l,selected:!1,height:u,fontSize:a,textAlign:(null==i?void 0:i.textAlign)||(n?m.center:m.left),...d,...n?{containerId:n.id}:{}},f=[],y=[...(null==n?void 0:n.boundingElements)||[],{id:s,type:p.text}];i?(f.push({id:s,value:{deleted:{content:i.content},payload:{content:h.content}}}),eW.collectUpdatedRecord(f)):(n&&f.push({id:n.id,value:{deleted:{boundingElements:n.boundingElements},payload:{boundingElements:y}}}),eW.collectAddedRecord([h],f)),r(e=>[...n?[...e.filter(e=>e.id!==n.id),{...n,boundingElements:y}]:e,h])}l.current=null};return{handleText:e=>{if(!e)return;let a=[...t,...n],u=eb(e,a),d=u?a.find(e=>e.id===(null==u?void 0:u.containerId))||null:ew(e,t);em(e,c,d,e=>{if(!d)return;if(!l.current){let e=document.querySelector("textarea");if(!e)return;l.current=e}let t=en(e),n=(null==u?void 0:u.fontSize)||15;l.current.style.top=d.y+d.height/2-n*t.length/2+"px"},u),u&&r(e=>e.filter(e=>e.id!==u.id)),o(y.default),i(p.selection)}}},eG=e=>{let{startCoordinate:t,moveCoordinate:n,activeDrawData:r,staticDrawData:l,setStaticDrawData:i,setActiveDrawData:o}=e,c=(0,f.Dv)(j),a=(0,U.useRef)(null),{handleCursorPoint:u}=eB({staticDrawData:l,moveCoordinate:n,setResizePosition:e=>{a.current=e}}),{handleText:d}=eX({staticDrawData:l,activeDrawData:r,setStaticDrawData:i}),{handleDrawElement:s}=eH({startCoordinate:t,moveCoordinate:n,staticDrawData:l,setStaticDrawData:i,setActiveDrawData:o}),h=(0,U.useRef)(),{handleMoveElement:y,handleResizeElement:g}=eq({resetSelectedHistoryRecordTimer:h,startCoordinate:t,moveCoordinate:n,staticDrawData:l,activeDrawData:r,setStaticDrawData:i,setActiveDrawData:o,resizePosition:a});(0,$.Z)("dblclick",e=>{if(c!==p.selection)return;let{pageX:t,pageY:n}=e;d({x:t,y:n})}),(0,eL.Z)(e=>{let n=null==e?void 0:e.includes(0);if(c===p.text&&n){d(t);return}if(y(n)||g()){clearTimeout(h.current);return}!s()&&u()},[t,n])};var eY=n(8988);let eQ=e=>{let{staticDrawData:t,setStaticDrawData:n,moveCoordinate:r}=e;(0,u.Z)(["meta.a"],()=>n(e=>e.map(e=>({...e,selected:!("containerId"in e)||!e.containerId})))),(0,u.Z)(["Backspace"],()=>{let e=eh(t);eW.collectRemovedRecord(e),n(t=>t.filter(t=>!e.some(e=>e.id===t.id)))});let l=(0,U.useRef)([]);(0,u.Z)(["meta.c"],()=>{let e=eh(t);l.current=e,e.length&&eY.ZP.success("复制成功")}),(0,u.Z)(["meta.v"],()=>{if(!l.current.length)return;let[e,t,i,o]=eu(l.current),c=r.x-(e+t)/2,a=r.y-(i+o)/2,u={},d=l.current.map(e=>{let t=(0,eJ.x0)();return u[e.id]=t,{...e,id:t,x:e.x+c,y:e.y+a,selected:!("containerId"in e)||!e.containerId}}).map(e=>{var t;return{...e,containerId:"containerId"in e&&e.containerId?u[e.containerId]:void 0,boundingElements:"boundingElements"in e?null===(t=e.boundingElements)||void 0===t?void 0:t.map(e=>({...e,id:u[e.id]})):void 0}});eW.collectAddedRecord(d),n(e=>[...e.map(e=>({...e,selected:!1})),...d])}),(0,u.Z)(["meta.z"],e=>{e.preventDefault();let r=eW.undo(t);r&&n(r)}),(0,u.Z)(["meta.y"],e=>{e.preventDefault();let r=eW.redo(t);r&&n(r)})},eV=()=>{let[e,t]=(0,U.useState)(null),[n,r]=(0,U.useState)({x:0,y:0});return(0,$.Z)("mousedown",e=>{let{pageX:n,pageY:r}=e;t({x:n,y:r})},{target:document}),(0,$.Z)("mousemove",e=>{let{pageX:t,pageY:n}=e;r({x:t,y:n})},{target:document}),(0,$.Z)("mouseup",()=>{t(null)},{target:document}),{startCoordinate:e,moveCoordinate:n}};var e0=n(2170);let e1=e=>{let{staticDrawData:t,setStaticDrawData:n}=e,r=(0,e0.Z)(()=>{eW.collectRemovedRecord(t),n([])}),l=(0,e0.Z)(()=>{let e=document.createElement("input");e.type="file",e.style.display="none",document.body.appendChild(e),e.click(),e.onchange=t=>{let r=t.target.files[0],l=new FileReader;l.onload=e=>{try{let t=JSON.parse(e.target.result);eW.collectAddedRecord(t),n(t)}catch(e){}},l.readAsText(r),document.body.removeChild(e)}}),i=(0,e0.Z)(()=>{if(!t.length){eY.ZP.info("暂无内容");return}eZ(eM(JSON.stringify(t)),x)}),o=(0,e0.Z)(()=>{if(!t.length){eY.ZP.info("暂无内容");return}let e=document.createElement("canvas"),n=e.getContext("2d"),r=W.Z.canvas(e);if(!n)return;let[l,i,o,c]=eu(t),a=i-l+30,u=c-o+30;e.width=a,e.height=u,n.save(),n.fillStyle="#fff",n.fillRect(0,0,a,u),n.restore(),ee(n,r,t.map(e=>({...e,x:e.x-l+15,y:e.y-o+15}))),eZ(e.toDataURL(),x)});(0,N.Z)(()=>{eE.on(R,r),eE.on(M,i),eE.on(Z,o),eE.on(E,l)})},e2=(e,t,n,r)=>{let[l,i]=(0,U.useState)([]),[o,c]=(0,U.useState)(()=>{try{return JSON.parse(localStorage.getItem(x)||"[]")}catch{return[]}}),{startCoordinate:a,moveCoordinate:u}=eV();eG({startCoordinate:a,moveCoordinate:u,staticDrawData:o,activeDrawData:l,setStaticDrawData:c,setActiveDrawData:i}),e1({staticDrawData:o,setStaticDrawData:c}),eQ({staticDrawData:o,setStaticDrawData:c,moveCoordinate:u}),eF({staticDrawData:o,activeDrawData:l,staticCanvasCtx:e,activeCanvasCtx:t,staticRoughCanvas:n,activeRoughCanvas:r})},e3=()=>{let e=(0,f.Dv)(k),{activeCanvasCtx:t,activeCanvasRef:n,staticCanvasCtx:r,staticCanvasRef:l,staticRoughCanvas:i,activeRoughCanvas:o}=F();return A([l,n],[r,t]),e2(r,t,i,o),(0,c.jsxs)("div",{className:"canvas_container-WF_R38",style:{cursor:e},children:[(0,c.jsx)("canvas",{ref:n}),(0,c.jsx)("canvas",{ref:l})]})};var e8=n(2307),e5=n(5082),e7=n(1397),e9=n(9551),e6=n(8161),e4=n(4897);let te=[{icon:e8.Z,label:"打开",key:E},{icon:e5.Z,label:"保存画布数据",key:M},{icon:e7.Z,label:"导出图片",key:Z},{icon:e9.Z,label:"重置画布",key:R}],tt=()=>{let e=te.map(e=>{let t=e.icon;return{label:(0,c.jsxs)("div",{className:"flex items-center",onClick:()=>eE.emit(e.key),children:[t?(0,c.jsx)(t,{..._,size:16,className:"mr-2"}):null,(0,c.jsx)("div",{className:"text-sm",children:e.label})]}),key:e.key}});return(0,c.jsx)("div",{className:"absolute top-3 left-3 rounded bg-slate-50 shadow p-1",children:(0,c.jsx)(e4.Z,{menu:{items:e},overlayClassName:"mt-8",trigger:["click"],children:(0,c.jsx)(e6.Z,{..._})})})};n(7883),a.createRoot(document.getElementById("root")).render((0,c.jsx)(()=>(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(tt,{}),(0,c.jsx)(D,{}),(0,c.jsx)(e3,{})]}),{}))}},t={};function n(r){var l=t[r];if(void 0!==l)return l.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(r,l){if(1&l&&(r=this(r)),8&l||"object"==typeof r&&r&&(4&l&&r.__esModule||16&l&&"function"==typeof r.then))return r;var i=Object.create(null);n.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var c=2&l&&r;"object"==typeof c&&!~e.indexOf(c);c=t(c))Object.getOwnPropertyNames(c).forEach(function(e){o[e]=function(){return r[e]}});return o.default=function(){return r},n.d(i,o),i}})(),n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=function(t,r,l,i){if(r){i=i||0;for(var o=e.length;o>0&&e[o-1][2]>i;o--)e[o]=e[o-1];e[o]=[r,l,i];return}for(var c=1/0,o=0;o<e.length;o++){for(var r=e[o][0],l=e[o][1],i=e[o][2],a=!0,u=0;u<r.length;u++)(!1&i||c>=i)&&Object.keys(n.O).every(function(e){return n.O[e](r[u])})?r.splice(u--,1):(a=!1,i<c&&(c=i));if(a){e.splice(o--,1);var d=l();void 0!==d&&(t=d)}}return t}})(),n.rv=function(){return"1.2.2"},(()=>{var e={980:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var l,i,o=r[0],c=r[1],a=r[2],u=0;if(o.some(function(t){return 0!==e[t]})){for(l in c)n.o(c,l)&&(n.m[l]=c[l]);if(a)var d=a(n)}for(t&&t(r);u<o.length;u++)i=o[u],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(d)},r=self.webpackChunkspicy_chicken_draw=self.webpackChunkspicy_chicken_draw||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.ruid="bundler=rspack@1.2.2";var r=n.O(void 0,["361","758"],function(){return n(4830)});r=n.O(r)})();